{% extends "nav.html" %}
{% block title %}Generate{% endblock title %}
{% block main %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="Description" content="Enter your description here"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="assets/css/style.css">
<title>Generate Recipe</title>
</head>
<style>
  /* Global styles */
  *{
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
  }
  
  body {
      background-image: url(https://static.vecteezy.com/system/resources/previews/027/865/586/non_2x/set-of-restaurant-doodles-food-and-drinks-on-black-background-vector.jpg);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-attachment: fixed;
      height: 100vh;
      margin: 0;
      padding: 0;
  }
  
  .container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 20px;
      
  }
  .glass-container {
    margin: 10px;
      display: none;
      width: 700px;
      max-height: 300px;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4.1px);
      -webkit-backdrop-filter: blur(4.1px);
      border: 1px solid rgba(255, 255, 255, 0.9);
      overflow-y: auto; /* Enable scrolling if content overflows */
      padding: 10px; /* Add some padding to the container */
  }

  .glass-container.expand {
      display: block;
      max-height: 1000px; /* Arbitrary large value to allow full expansion */
      opacity: 1;
  }

  #second-submit {
      display: none;
      margin-top: 10px;
  }

  label {
      color: white;
  }

 /* From Uiverse.io by AlimurtuzaCodes */ 
.btn {
  border: none;
  width: 15em;
  height: 5em;
  border-radius: 3em;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  background: #000000;
  cursor: pointer;
  transition: all 450ms ease-in-out;
}

.sparkle {
  fill: #AAAAAA;
  transition: all 800ms ease;
}

.text {
  font-weight: 600;
  color: #AAAAAA;
  font-size: medium;
}

.btn:hover {
  background: linear-gradient(0deg,#A47CF3,#683FEA);
  box-shadow: inset 0px 1px 0px 0px rgba(255, 255, 255, 0.4),
  inset 0px -4px 0px 0px rgba(0, 0, 0, 0.2),
  0px 0px 0px 4px rgba(255, 255, 255, 0.2),
  0px 0px 180px 0px #9917FF;
  transform: translateY(-2px);
}

.btn:hover .text {
  color: white;
}

.btn:hover .sparkle {
  fill: white;
  transform: scale(1.2);
} 
/* HTML: <div class="loader"></div> */
#loader {
  width: 400px;
  height: 15px;
  border-radius: 20px;
  color: #ffffff;
  border: 2px solid;
  position: relative;
}
#loader::before {
  content: "";
  position: absolute;
  margin: 2px;
  inset: 0 100% 0 0;
  border-radius: inherit;
  background: currentColor;
  animation: l6 2s infinite;
}
@keyframes l6 {
    100% {inset:0}
}
@keyframes l5 {
    0%  {box-shadow: 20px 0 #ffffff, -20px 0 rgba(255, 255, 255, 0.133);background: #000 }
    33% {box-shadow: 20px 0 #ffffff, -20px 0 #0002;background: #0002}
    66% {box-shadow: 20px 0 rgba(255, 255, 255, 0.133),-20px 0 #000; background: #0002}
    100%{box-shadow: 20px 0 rgba(255, 255, 255, 0.133),-20px 0 #000; background: #000 }
}
.messageBox {
  width: fit-content;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #ffffff51;
  padding: 0 15px;
  border-radius: 10px;
  border: 1px solid rgb(255, 255, 255);
}
.messageBox:focus-within {
  border: 1px solid rgb(249, 249, 249);
}
.fileUploadWrapper {
  width: fit-content;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: Arial, Helvetica, sans-serif;
}

#file {
  display: none;
}
.fileUploadWrapper label {
  cursor: pointer;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.fileUploadWrapper label svg {
  height: 18px;
}
.fileUploadWrapper label svg path {
  transition: all 0.3s;
}
.fileUploadWrapper label svg circle {
  transition: all 0.3s;
}
.fileUploadWrapper label:hover svg path {
  stroke: #fff;
}
.fileUploadWrapper label:hover svg circle {
  stroke: #fff;
  fill: #ffffff;
}
.fileUploadWrapper label:hover .tooltip {
  display: block;
  opacity: 1;
}
.tooltip {
  position: absolute;
  top: -40px;
  display: none;
  opacity: 0;
  color: rgb(53, 48, 48);
  font-size: 10px;
  text-wrap: nowrap;
  background-color: #000;
  padding: 6px 10px;
  border: 1px solid #3c3c3c;
  border-radius: 5px;
  box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.596);
  transition: all 0.3s;
}
#items {
  width: 200px;
  height: 100%;
  background-color: transparent;
  outline: none;
  border: none;
  padding-left: 10px;
  color: rgb(227, 227, 227);
}
#items:focus ~ #sendButton svg path,
#items:valid ~ #sendButton svg path {
  fill: #ffffff;
  stroke: white;
}

#first-submit  {
  width: fit-content;
  height: 40px;
  background-color: transparent;
  outline: none;
  border: none;
  display: flex;
  align-items: center;
  justify-content: end;
  cursor: pointer;
  transition: all 0.3s;
}
#first-submit svg {
  height: 18px;
  transition: all 0.3s;
}
#first-submit svg path {
  transition: all 0.3s;
}
#first-submit:hover svg path {
  fill: #3c3c3c;
  stroke: white;
}
input::placeholder {
    color: #fffdfd;
    opacity: 0.5;
}
.hi {
    display: flex;
    gap: 10px;
}
input:focus {
    background-color: #e4e4e4; /* Ensure the background color stays the same on focus */
    color: rgb(255, 255, 255); /* Keep the text color consistent */
    border-color: #999; /* Optional: change the border color on focus */
}
.pp{
    top: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
}
@media (max-width: 420px) {
    .container {
        padding: 0px;
        margin: 0;
    }
    .messageBox {
      margin-top: 10px;
      margin-bottom: 5px;
    }

    .glass-container {
        margin-top: 5px;
        width:380px ;
        max-height: 1700px;
        font-size: 15px;
        overflow-y: auto;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
    button {
      margin-top: 10px;
      margin-bottom: 5px;
    }

    #loader {
        width: 100%;
        max-width: 300px;
    }

    #items {
        width: 100%;
        max-width: 300px;
    }
}

</style>


<body>
    <div class="container">
        <form id="wishlist-form">
            {% csrf_token %}
            <!-- <div class="input">
                <label for="name">Enter items</label>
                <input type="text" name="pitems" id="items" required>
                <button type="submit" id="first-submit" class="btn btn-primary">Generate</button>
            </div> -->
<div class="hi">
<div class="messageBox">
  <div class="fileUploadWrapper">
    <label for="file">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 337 337">
        <circle
          stroke-width="20"
          stroke="#6c6c6c"
          fill="none"
          r="158.5"
          cy="168.5"
          cx="168.5"
        ></circle>
        <path
          stroke-linecap="round"
          stroke-width="25"
          stroke="#6c6c6c"
          d="M167.759 79V259"
        ></path>
        <path
          stroke-linecap="round"
          stroke-width="25"
          stroke="#6c6c6c"
          d="M79 167.138H259"
        ></path>
      </svg>
    </label>
  </div>
  <input required="" placeholder="Enter items..." type="text" name="pitems" id="items" />
</div>

<button class="btn" type="submit" id="first-submit" style="border: 1px solid white;">
    <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" data-name="Layer 1" id="Layer_1" class="sparkle">
        <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
    </svg>

    <span class="text">Generate</span>
</button>
            </div>
            <div  id="loader" style="display: none;margin: 10px;">
                <div class="spinner"></div>
                
            </div>
        
            <!-- Hidden field to store the generated recipe -->
            <input type="hidden" id="stored-recipe" name="recipe" value="">
        
            <!-- Container to display the generated recipe -->
            <div class="glass-container" id="recipe-container" style="display: none;">
                <pre style="color: white; margin: 5px;" id="generated-recipe"></pre>
            </div>
        
            <!-- Second submit button to add the recipe to the wishlist -->
            <button class="btn" type="submit" id="second-submit" style="display: none;">
              <svg height="24" width="24" fill="#FFFFFF" viewBox="0 0 24 24" data-name="Layer 1" id="Layer_1" class="sparkle">
                  <path d="M10,21.236,6.755,14.745.264,11.5,6.755,8.255,10,1.764l3.245,6.491L19.736,11.5l-6.491,3.245ZM18,21l1.5,3L21,21l3-1.5L21,18l-1.5-3L18,18l-3,1.5ZM19.333,4.667,20.5,7l1.167-2.333L24,3.5,21.667,2.333,20.5,0,19.333,2.333,17,3.5Z"></path>
              </svg>
          
              <span class="text">Add to Wishlist</span>
          </button>
        </form>
        
    </div>
    
    <script>
        document.getElementById('wishlist-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            
            var items = document.getElementById('items').value;
            var storedRecipeInput = document.getElementById('stored-recipe');
            
            if (event.submitter.id === 'first-submit') {
                // If the "Generate" button was clicked
                fetch("{% url 'generate_recipe' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ items: items })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('generated-recipe').textContent = data.recipe;
        
                    // Store the generated recipe in the hidden input field
                    storedRecipeInput.value = data.recipe;
        
                    // Show the recipe container
                    document.getElementById('recipe-container').style.display = 'block';
        
                    // Show the "Add to Wishlist" button
                    document.getElementById('second-submit').style.display = 'inline-block';
        
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else if (event.submitter.id === 'second-submit') {
                // If the "Add to Wishlist" button was clicked
                fetch("{% url 'add_to_wishlist' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ items: items, recipe: storedRecipeInput.value }) // Updated to include both items and recipe
                })
                .then(response => {
                    if (response.ok) {
                        // Handle success, maybe redirect to the wishlist page or show a success message
                        alert('Recipe added to wishlist!');
                    } else {
                        // Handle error
                        alert('Failed to add recipe to wishlist.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        });
        
        
        function showLoader() {
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
        
            setTimeout(function() {
                loader.style.display = 'none';
            }, 2000); // Hide the loader after 2 seconds
        }
        
        // Trigger the loader on form submission or any other event
        document.getElementById('first-submit').addEventListener('click', function() {
            showLoader();
        });
        

    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.0/js/bootstrap.min.js"></script>
</body>
</html>
{% endblock main %}
